(venv) ubuntu@computeinstance-e00f6h86c4me9as6r7:~/llm-trust-lens$ python src/experiment.py --config config/experiment/ollama_llama3_2_3b_fewshot_banking77_thresholdtest.yaml
--- Starting Experiment ---
Experiment Config: config/experiment/ollama_llama3_2_3b_fewshot_banking77_thresholdtest.yaml
Dataset: banking, Model: llama3.2:3b, Technique: fewshot
Results will be saved to: /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest
--- Initializing Ollama ---
Ollama server is already running.
Model 'llama3.2:3b' is already available locally.
--- Ollama Initialization Complete ---
Loading all splits from directory: /home/ubuntu/llm-trust-lens/data/banking
Loading label map from: /home/ubuntu/llm-trust-lens/data/banking/banking77_idx2label.csv
Successfully loaded dataset 'banking' with 3080 records and 77 labels.

--- Applying Data Processing from Experiment Config ---
================================================================================
Original dataset intents: ['Refund_not_showing_up', 'activate_my_card', 'age_limit', 'apple_pay_or_google_pay', 'atm_support', 'automatic_top_up', 'balance_not_updated_after_bank_transfer', 'balance_not_updated_after_cheque_or_cash_deposit', 'beneficiary_not_allowed', 'cancel_transfer', 'card_about_to_expire', 'card_acceptance', 'card_arrival', 'card_delivery_estimate', 'card_linking', 'card_not_working', 'card_payment_fee_charged', 'card_payment_not_recognised', 'card_payment_wrong_exchange_rate', 'card_swallowed', 'cash_withdrawal_charge', 'cash_withdrawal_not_recognised', 'change_pin', 'compromised_card', 'contactless_not_working', 'country_support', 'declined_card_payment', 'declined_cash_withdrawal', 'declined_transfer', 'direct_debit_payment_not_recognised', 'disposable_card_limits', 'edit_personal_details', 'exchange_charge', 'exchange_rate', 'exchange_via_app', 'extra_charge_on_statement', 'failed_transfer', 'fiat_currency_support', 'get_disposable_virtual_card', 'get_physical_card', 'getting_spare_card', 'getting_virtual_card', 'lost_or_stolen_card', 'lost_or_stolen_phone', 'order_physical_card', 'passcode_forgotten', 'pending_card_payment', 'pending_cash_withdrawal', 'pending_top_up', 'pending_transfer', 'pin_blocked', 'receiving_money', 'request_refund', 'reverted_card_payment?', 'supported_cards_and_currencies', 'terminate_account', 'top_up_by_bank_transfer_charge', 'top_up_by_card_charge', 'top_up_by_cash_or_cheque', 'top_up_failed', 'top_up_limits', 'top_up_reverted', 'topping_up_by_card', 'transaction_charged_twice', 'transfer_fee_charged', 'transfer_into_account', 'transfer_not_received_by_recipient', 'transfer_timing', 'unable_to_verify_identity', 'verify_my_identity', 'verify_source_of_funds', 'verify_top_up', 'virtual_card_not_working', 'visa_or_mastercard', 'why_verify_identity', 'wrong_amount_of_cash_received', 'wrong_exchange_rate_for_cash_withdrawal']
Number of original intents: 77

================================================================================
Original intents to convert to OOS class:
   0  activate_my_card
   1  age_limit
   2  apple_pay_or_google_pay
   3  atm_support
   4  automatic_top_up
   5  balance_not_updated_after_bank_transfer
   6  balance_not_updated_after_cheque_or_cash_deposit
   7  beneficiary_not_allowed
   8  cancel_transfer
   9  card_about_to_expire
  10  card_acceptance
  11  card_arrival
  12  card_delivery_estimate
  13  card_linking
  14  card_not_working
  15  card_payment_fee_charged
  16  card_payment_not_recognised
  17  card_payment_wrong_exchange_rate
  18  card_swallowed
  19  cash_withdrawal_charge
  20  cash_withdrawal_not_recognised
  21  change_pin
  22  compromised_card
  23  contactless_not_working
  24  country_support
  25  declined_card_payment
  26  declined_cash_withdrawal
  27  declined_transfer
  28  direct_debit_payment_not_recognised
  29  disposable_card_limits
  30  edit_personal_details
  31  exchange_charge
  32  exchange_rate
  33  exchange_via_app
  34  extra_charge_on_statement
  35  failed_transfer
  36  fiat_currency_support
  37  get_disposable_virtual_card
  38  get_physical_card
  39  getting_spare_card
  40  getting_virtual_card
  41  lost_or_stolen_card
  42  lost_or_stolen_phone
  43  order_physical_card
  44  passcode_forgotten
  45  pending_card_payment
  46  pending_cash_withdrawal
  47  pending_top_up
  48  pending_transfer
  49  pin_blocked
  50  receiving_money
  51  refund_not_showing_up
  52  request_refund
  53  reverted_card_payment?
  54  supported_cards_and_currencies
  55  terminate_account
  56  top_up_by_bank_transfer_charge
  57  top_up_by_card_charge
  58  top_up_by_cash_or_cheque
  59  top_up_failed
  60  top_up_limits
  61  top_up_reverted
  62  topping_up_by_card
  63  transaction_charged_twice
  64  transfer_fee_charged
  65  transfer_into_account
  66  transfer_not_received_by_recipient
  67  transfer_timing
  68  unable_to_verify_identity
  69  verify_my_identity
  70  verify_source_of_funds
  71  verify_top_up
  72  virtual_card_not_working
  73  visa_or_mastercard
  74  why_verify_identity
  75  wrong_amount_of_cash_received
Percentage of original intents to convert to OOS class: 0.987012987012987

Non-OOS labels to preserve: ['wrong_exchange_rate_for_cash_withdrawal']

Preserving 1 non-OOS labels (Total classes: 77, Converting to OOS: 76)
Labels to preserve: ['wrong_exchange_rate_for_cash_withdrawal']
Final label count: 2 labels
Labels: ['oos', 'wrong_exchange_rate_for_cash_withdrawal']
================================================================================
Unique intents after converting some to OOS class:
['oos', 'wrong_exchange_rate_for_cash_withdrawal']
Number of unique intents after converting some to OOS class: 2

================================================================================
sanity check
Number of original intents: 77
Number of original intents to convert to OOS class: 76
Percentage of original intents to convert to OOS class: 0.987012987012987
Number of unique intents after conversion: 2
Labels after conversion: ['oos', 'wrong_exchange_rate_for_cash_withdrawal']
Numbers match expected count: True
Prepared unique intents
Dataset filtered to 10 examples that were originally 'activate_my_card' and converted to 'oos' (requested 10, available 12880).

--- Preparing Model and Prompts ---
Loading few-shot examples content directly from: /home/ubuntu/llm-trust-lens/prompts/few_shot_examples/banking77/banking_only1notoos.txt

--- Running Inference ---
Processing 10 records from index 0 to 10.

--- Example Prompt (for first item) ---
You are an expert in understanding and identifying what users are asking you.

Your task is to analyze an input query from a user and assign the most appropriate category from the following list:
- wrong_exchange_rate_for_cash_withdrawal

Only classify as "oos" (out of scope category) if none of the other categories apply.

Below are several examples to guide your classification:

---
Example 1:
Question: "When I got cash, the exchange rate applied was wrong."
Category:
{{
  "category": "wrong_exchange_rate_for_cash_withdrawal",
  "confidence": 85.25
}}
---

===============================

New Question: I want to get some cash from the ATM using my card but I dont want to be charged any fees. Ive taken some money out before with no fees, but recently Ive been getting charged. Why?

===============================

Provide your final classification in **valid JSON format** with the following structure:
{
  "category": "your_chosen_category_name",
  "confidence": confidence_level_rounded_to_the_nearest_2_decimal_places
}


Ensure the JSON has:
- Opening and closing curly braces
- Double quotes around keys and string values
- Confidence as a number (not a string), with maximum 2 decimal places

Do not include any explanations or extra text.

--------------------------------------

  Processed 2/10 | Elapsed: 00:00:08 | ETA: 00:00:32
  Processed 4/10 | Elapsed: 00:00:12 | ETA: 00:00:18
  Processed 6/10 | Elapsed: 00:00:15 | ETA: 00:00:10
  Processed 8/10 | Elapsed: 00:00:19 | ETA: 00:00:04
  Processed 10/10 | Elapsed: 00:00:23 | ETA: 00:00:00

Raw predictions saved to /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest/results_llama3.2_3b_banking_0_9.json

--- Generating Evaluation Metrics ---

Metrics summary saved to /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest/metrics_llama3.2_3b_banking.txt
Open vs Known metrics summary saved to /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest/metrics_llama3.2_3b_banking_open_vs_known.txt

Classification Report saved to /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest/classification_report_llama3.2_3b_banking.txt
Open vs Known Classification Report saved to /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest/classification_report_llama3.2_3b_banking_open_vs_known.txt
Confusion matrix saved to /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest/cm_llama3.2_3b_banking.csv
Confusion matrix plot saved to /home/ubuntu/llm-trust-lens/results/banking77_fewshot_thresholdtest/cm_llama3.2_3b_banking.png

--- Experiment Finished ---



